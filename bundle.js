!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/shop-admin-page/",s(s.s=38)}([function(t,e,s){"use strict";var i="content"in document.createElement("template")?function(t){const e=document.createElement("template");return e.innerHTML=t,e.content.firstElementChild}:function(t){const e=document.createElement("div");return e.innerHTML=t,e.firstElementChild};function n(t){return t.replace(/&/g,"&").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"<").replace(/>/g,">")}function a({tmpl:t,data:e}){if(t&&e)return t.replace(/{([^"]{1,})}/g,(t,s)=>void 0!==e[s]?e[s]:"")}function r(t){const e=new Date(t).toDateString().split(" ");return`${e[1]} ${e[2]}, ${e[3]}`}function o(t){let e=t;if(t>=1e3){const s=t%1e3;e=`${(t-s)/1e3},${s}`}return`$${e}`}function l(t){const e=new Date(1970,0,5);let s="",i=0;for(;i<7;){s+=`<${t}>${e.toLocaleString("default",{weekday:"narrow"})}</${t}>`,e.setDate(e.getDate()+1),i++}return s}function c(t,e,s){let i,n,a=!1;return function(){i=arguments,a?n=i:(t.apply(e,i),a=!0,setTimeout((function(){t.apply(e,n),a=!1}),s))}}var d=s(9);async function u(t,e){let s;try{s=await fetch(t,e)}catch(e){throw new h(s,null,`Network error for url ${t}`)}if(!s.ok){let e;const i=s.statusText;try{e=await s.json()}catch(t){}let n=`Error ${s.status} for url ${t}`;throw i&&(n+=`: ${i}`),new h(s,e,n)}try{s=await s.json()}catch(t){throw new h(s,null,t.message)}return s}class h extends Error{constructor(t,e,s){super(s),this.name="FetchError",this.response=t,this.body=e}}window.addEventListener("unhandledrejection",t=>{t.reason instanceof h&&Object(d.a)(t.reason.message,"error")}),s.d(e,"a",(function(){return i})),s.d(e,"b",(function(){return n})),s.d(e,"d",(function(){return a})),s.d(e,"e",(function(){return r})),s.d(e,"f",(function(){return o})),s.d(e,"g",(function(){return l})),s.d(e,"h",(function(){return c})),s.d(e,"c",(function(){return u}))},function(t,e,s){"use strict";e.a={pageContent:"page-content",pageContentCreate:"page-content--create",pageContentTitle:"page-content__title",pageContentTitleMain:"page-content__title-maintext",form:"product-form",list:"product-form__list",item:"product-form__item",itemTiny:"product-form__item--tiny",itemFollow:"product-form__item--follow",itemFull:"product-form__item--full",label:"product-form__label",input:"product-form__input",inputUpload:"product-form__upload",inputUploadColored:"control control--blue",inputUploadLoading:"control--loading",inputText:"product-form__input--text",inputNumber:"product-form__input--number",inputSelect:"product-form__input--select",inputTextarea:"product-form__input--textarea",imgsList:"product-form__images-list",imgsItem:"product-form__images-item",img:"product-form__image",imgWrapper:"product-form__image-wrapper",imgSource:"product-form__image-source",imgRemove:"product-form__image-remove",preview:"product-form__preview",footer:"product-form__footer",submit:"product-form__submit",submitColored:"control control--dark-blue"}},function(t,e,s){"use strict";e.a={elem:"sortable-table",table:"sortable-table__table",thead:"sortable-table__thead",tbody:"sortable-table__tbody",header:"sortable-table__header",row:"sortable-table__row",cell:"sortable-table__cell",cellMessage:"sortable-table__cell--message",cellSorter:"sortable-table__cell--sorter",img:"sortable-table__image",imgWrapper:"sortable-table__image-wrapper",preview:"sortable-table__preview",link:"sortable-table__link",category:"sortable-table__category",tooltipCategory:"sortable-table__tooltip-category",tooltipSubcategory:"sortable-table__tooltip-subcategory"}},function(t,e,s){"use strict";e.a={elem:"categories",list:"categories__list",listTop:"categories__list--topcategories",listSubcats:"categories__list--subcategories",item:"categories__item",itemTop:"categories__item--topcategory",itemSub:"categories__item--subcategory",itemOpen:"categories__item--open",toggler:"categories__toggler",counter:"categories__counter"}},function(t,e,s){"use strict";s.d(e,"a",(function(){return n})),s.d(e,"c",(function(){return a})),s.d(e,"f",(function(){return r})),s.d(e,"d",(function(){return o})),s.d(e,"g",(function(){return l})),s.d(e,"e",(function(){return c})),s.d(e,"b",(function(){return d}));var i=s(1);const n=`<header class="page-content__header">\n  <h2 class="${i.a.pageContentTitle}">\n    <a\n      class="page-content__title-link"\n      href="/shop-admin-page/products">Products</a>\n    /\n    <span class="${i.a.pageContentTitleMain}">{title}</span>\n  </h2>\n\n  <a\n    class="page-content__header-create control control--green"\n    href="/shop-admin-page/products/add">Add Product\n  </a>\n</header>`,a='<input\n    type="hidden"\n    name="{id}"\n    value="{value}"/>\n',r=`<label class="${i.a.label}">\n  {fieldName}\n\n  <input\n    class="${i.a.input} ${i.a.inputText}"\n    type="text"\n    name="{id}"\n    value="{value}"/>\n</label>`,o=`<label class="${i.a.label}">\n  {fieldName}\n\n  <input\n    class="${i.a.input} ${i.a.inputNumber}"\n    type="number"\n    name="{id}"\n    value="{value}"/>\n</label>`,l=`<label class="${i.a.label}">\n  {fieldName}\n\n  <textarea\n    class="${i.a.input} ${i.a.inputTextarea}"\n    name="{id}">{value}</textarea>\n</label>`,c=`<label class="${i.a.label}">\n  {fieldName}\n\n  <select\n    class="${i.a.input} ${i.a.inputSelect}"\n    name="{id}">\n    {options}\n  </select>\n</label>`,d=`<li class="${i.a.imgsItem}">\n  <input type="hidden" name="image-{source}" value="{url}"/>\n  <input type="hidden" name="image-{source}" value="{source}"/>\n  <div class="${i.a.imgWrapper}">\n    <img src="{url}" class="${i.a.img}">\n    <span style="background-image: url({url})" class="${i.a.preview}"><span>\n  </div>\n  <span class="${i.a.imgSource}">{source}</span>\n  <button type="button" class="${i.a.imgRemove}">Remove</button>\n</li>`},function(t,e,s){"use strict";e.a={elem:"column-chart",content:"column-chart__content",header:"column-chart__header",title:"column-chart__title",total:"column-chart__total",list:"column-chart__list",item:"column-chart__item",tooltip:"column-chart__tooltip",tooltipDate:"column-chart__tooltip-date",tooltipQuantity:"column-chart__tooltip-quantity",error:"column-chart__error"}},function(t,e,s){"use strict";var i=s(0),n=s(4),a=s(7),r=s(1),o=[{name:"title"},{name:"description",mods:[r.a.itemFull]},{name:"images",mods:[r.a.itemFull]},{name:"subcategory"},{name:"price",mods:[r.a.itemTiny]},{name:"discount",mods:[r.a.itemTiny,r.a.itemFollow]},{name:"quantity",mods:[r.a.itemTiny]},{name:"status",mods:[r.a.itemTiny]}];function l(t){const e=[];for(const s of t)for(const t of s.subcategories)e.push({value:t.id,text:`${s.title} > ${t.title}`});return e}function c(t,e){return t.map((t,s)=>{const i=t.value||s,n=t.text||t;return`<option value="${i}" ${i===e?"selected":""}>${n}</option>`}).join("")}function d(t=[]){const e=t.map(t=>Object(i.d)({tmpl:n.b,data:t}));return`\n    <ul class="${r.a.imgsList}" is="draggable-list">${e.join(" ")}</ul>\n    <button type="button" class="${r.a.inputUpload} ${r.a.inputUploadColored}">Upload</button>\n  `}function u(t){let e="Edit Product";return t||(e="Create Product"),e}function h(t){const e=u(t);return Object(i.d)({tmpl:n.a,data:{title:e}})}function m({product:t,categories:e}){const s=[];for(const{name:i,mods:n}of o)if(a.a[i]){let o=t||{};"subcategory"===i&&(o={...o,categories:e});const l=a.a[i].render(o);let c=[r.a.item];n&&(c=c.concat(n)),s.push(`<li class="${c.join(" ")}">${l}</li>`)}return s}function p(t){return+t}s.d(e,"a",(function(){return l})),s.d(e,"e",(function(){return c})),s.d(e,"c",(function(){return d})),s.d(e,"f",(function(){return u})),s.d(e,"b",(function(){return h})),s.d(e,"d",(function(){return m})),s.d(e,"g",(function(){return p}))},function(t,e,s){"use strict";var i=s(4),n={0:"Disabled",1:"Enabled"},a=s(0),r=s(6);e.a={id:{render({id:t}){const e={id:"id",value:t};return Object(a.d)({tmpl:i.c,data:e})}},images:{render:({images:t})=>Object(r.c)(t)},title:{render({title:t}){const e={id:"title",fieldName:"Name",value:t};return Object(a.d)({tmpl:i.f,data:e})}},description:{render({description:t}){const e={id:"description",fieldName:"Description",value:t};return Object(a.d)({tmpl:i.g,data:e})}},subcategory:{render({categories:t,subcategory:e}){const s={id:"subcategory",fieldName:"Category",options:Object(r.e)(Object(r.a)(t),e)};return Object(a.d)({tmpl:i.e,data:s})}},quantity:{render({quantity:t}){const e={id:"quantity",fieldName:"Quantity",value:t};return Object(a.d)({tmpl:i.d,data:e})},formatForRequest:r.g},price:{render({price:t}){const e={id:"price",fieldName:"Price",value:t};return Object(a.d)({tmpl:i.d,data:e})},formatForRequest:r.g},discount:{render({discount:t}){const e={id:"discount",fieldName:"Discount",value:t};return Object(a.d)({tmpl:i.d,data:e})},formatForRequest:r.g},status:{render({status:t}){const e={id:"status",fieldName:"Status",value:t,options:Object(r.e)(Object.values(n),t)};return Object(a.d)({tmpl:i.e,data:e})},formatForRequest:r.g}}},function(t,e,s){"use strict";var i=s(0),n=s(10),a=s(13),r=s(2);e.a={images:{title:"Image",render({images:t}){if(!t||!t[0])return"";const e=t[0].url;return`<div class="${r.a.imgWrapper}">\n      <img src="${e}" class="${r.a.img}">\n      <span style="background-image: url(${e})" class="${r.a.preview}"><span>\n      </div>`},compare:null},title:{title:"Name",render:({title:t,id:e})=>`\n      ${t}\n      `,compare:(t,e)=>t.title.localeCompare(e.title)},subcategory:{title:"Category",render({subcategory:t}){const e=t.category,s=`<span class="${r.a.tooltipCategory}">${e.title}</span>/<span class="${r.a.tooltipSubcategory}">${t.title}</span>`;return`<span class="${r.a.category}" data-tooltip-content="${Object(i.b)(s)}">${t.title}</span>`},compare(t,e){const s=t.subcategory.title,i=e.subcategory.title;return s.localeCompare(i)}},quantity:{title:"Quantity",render:({quantity:t})=>t,compare:(t,e)=>t.quantity-e.quantity},price:{title:"Price",render:({price:t})=>Object(i.f)(t),compare:(t,e)=>t.price-e.price},status:{title:"Status",render:({status:t})=>a.a[t],compare:(t,e)=>t.status-e.status,formatForQuery({key:t,value:e}){if(isFinite(e)&&""!==e)return{key:t,value:+e}}},search:{title:"Search",formatForQuery({key:t,value:e}){if(e.trim())return{key:"title_like",value:e.trim()}}},price_gte:{formatForQuery:n.a},price_lte:{formatForQuery:n.a}}},function(t,e,s){"use strict";s(18);const i={elem:"notification",warning:"notification--warning",error:"notification--error",success:"notification--success"};class n{constructor({message:t,container:e,type:s}){this.message=t,this.container=e,this.type=s,this.duration=this.getDuration(),this.classNames=this.getClasses(),this.addElem(),this.isFinished=!1}addElem(){this.elem=document.createElement("div"),this.elem.classList.add(...this.classNames),this.elem.dataset.state="shown",this.elem.innerHTML=this.message,this.container.prepend(this.elem),setTimeout(()=>{this.hideElem()},this.duration)}async hideElem(t={}){return this.isFinished=!0,this.elem.dataset.state="hidden",new Promise((t,e)=>{this.elem.addEventListener("animationend",()=>{this.elem.remove(),t()})})}getDuration(){return"error"===this.type?6e3:3e3}getClasses(){const t=[i.elem];return this.type&&i[this.type]&&t.push(i[this.type]),t}}s.d(e,"a",(function(){return o}));const a=document.createElement("div");a.classList.add("notifications"),document.body.append(a);let r=[];async function o(t,e){const s=new n({message:t,container:a,type:e});r.push(s),s.elem.offsetTop<0&&(r=r.filter(t=>!t.isFinished),r.shift().hideElem())}},function(t,e,s){"use strict";var i={0:"desc",1:"asc"};s.d(e,"b",(function(){return n})),s.d(e,"a",(function(){return a}));const n=t=>i[+t],a=({key:t,value:e})=>({key:t,value:+e})},function(t,e,s){"use strict";s.d(e,"a",(function(){return i}));s(23);class i{constructor({title:t,text:e,error:s}){this.title=t,this.text=e||"Something went wrong",this.error=s,!this.title&&this.error&&(this.title="Error"),this.createElement()}createElement(){this.elem=document.createElement("div"),this.elem.classList.add("page-message"),this.error&&this.elem.classList.add("page-message--error"),this.content=`<h3>${this.title}</h3><p>${this.text}</p>`,this.error&&(this.content+=`<div class="page-message__error">\n        <div class="page-message__error-text">\n          <strong>${this.error.name}</strong>: ${this.error.message}</div>\n      </div>`),this.elem.insertAdjacentHTML("afterBegin",this.content)}}},function(t,e){var s,i,n=t.exports={};function a(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(s===setTimeout)return setTimeout(t,0);if((s===a||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(e){try{return s.call(null,t,0)}catch(e){return s.call(this,t,0)}}}!function(){try{s="function"==typeof setTimeout?setTimeout:a}catch(t){s=a}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(t){i=r}}();var l,c=[],d=!1,u=-1;function h(){d&&l&&(d=!1,l.length?c=l.concat(c):u=-1,c.length&&m())}function m(){if(!d){var t=o(h);d=!0;for(var e=c.length;e;){for(l=c,c=[];++u<e;)l&&l[u].run();u=-1,e=c.length}l=null,d=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function p(t,e){this.fun=t,this.array=e}function g(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)e[s-1]=arguments[s];c.push(new p(t,e)),1!==c.length||d||o(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=g,n.addListener=g,n.once=g,n.off=g,n.removeListener=g,n.removeAllListeners=g,n.emit=g,n.prependListener=g,n.prependOnceListener=g,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},function(t,e,s){"use strict";e.a={0:"Disabled",1:"Enabled"}},function(t,e,s){"use strict";var i=s(0),n="tooltips-container",a="tooltips-container--dimmed",r="tooltip";s(20);s.d(e,"a",(function(){return o}));class o{constructor({elem:t,dimSiblings:e}){this.elem=t,this.elem.classList.add(n),this.dimSiblings=e,this.tooltip=Object(i.a)(`<div class="${r}"></div>`),this.elem.append(this.tooltip),this.listMouseMove=this.listMouseMove.bind(this),this.listMouseOut=this.listMouseOut.bind(this),this.elem.addEventListener("mousemove",this.listMouseMove),this.elem.addEventListener("mouseleave",this.listMouseOut)}listMouseMove(){if(!event.target.dataset.tooltipContent)return void this.hideTooltip();const{tooltipContent:t}=event.target.dataset;this.tooltip.innerHTML=t,this.tooltip.dataset.visible=1,this.elemCoords=this.elem.getBoundingClientRect();const e={x:event.clientX-this.elemCoords.x,y:event.clientY-this.elemCoords.y};this.tooltip.style=`transform: translate(${e.x}px, ${e.y}px)`,this.tooltipCoords=this.tooltip.getBoundingClientRect();const s=this.tooltipCoords.right-document.documentElement.clientWidth;s>0&&(e.x-=s,this.tooltip.style=`transform: translate(${e.x}px, ${e.y}px)`),this.dimSiblings&&this.elem.classList.add(a)}listMouseOut(){event.target.dataset.tooltipContent||this.hideTooltip()}hideTooltip(){this.tooltip.dataset.visible=0,this.elem.classList.remove(a)}}},function(t,e,s){"use strict";var i=s(5);const n=`<header class="${i.a.header}">\n  <h3 class="${i.a.title}">{title}</h3>\n  <div class="${i.a.total}">{total}</div>\n</header>`,a=`<li\n  class="${i.a.item}"\n  data-tooltip-content="{tootipContent}"\n  style="height: {height}"></li>`;e.a={header:n,chartItem:a}},function(t,e,s){"use strict";(function(t){s.d(e,"a",(function(){return o}));var i=s(14),n=s(0),a=s(5),r=s(15);s(21);class o extends HTMLElement{constructor(){super(),this.elem=document.createElement("div"),this.apiUrl=t.env.API_URL||"https://course-js.javascript.ru",this.changeDate=this.changeDate.bind(this)}async connectedCallback(){const{type:t,isMoney:e,from:s,to:i}=this.dataset;this.dates={from:s,to:i},this.type=t,this.formatTotal=e?n.f:null,this.classList.add(a.a.elem,`${a.a.elem}--${t}`),this.elem.classList.add(a.a.content),this.title=`Total ${t}`,this.url=this.getUrl(),await this.render(),this.append(this.elem),document.addEventListener("changeDate",this.changeDate)}getUrl(){return`${this.apiUrl}/api/dashboard/${this.type}?from=${this.dates.from}&to=${this.dates.to}`}async getData(){try{return{data:await Object(n.c)(this.url)}}catch(t){return{error:t}}}async render(){const{data:t,error:e}=await this.getData();if(this.data=t,e)return void this.elem.insertAdjacentHTML("beforeEnd",`<div class="${a.a.error}">${e}</div>`);this.values=Object.values(this.data),0===this.values.length&&this.values.push("No data");const s=this.getHeaderStr(),i=this.getListStr();this.elem.insertAdjacentHTML("beforeEnd",s+i),this.addActions()}getHeaderStr(){return this.total=this.values.reduce((t,e)=>t+e,0),this.formatTotal&&(this.total=this.formatTotal(this.total)),Object(n.d)({tmpl:r.a.header,data:this})}getListStr(){const t=Math.max(...this.values);let e="";for(const s in this.data){const i=Object(n.e)(s);let o=this.data[s];const l=`${(o/t*100).toFixed(2)}%`;this.formatTotal&&(o=this.formatTotal(o));const c=`<small class="${a.a.tooltipDate}">${i}</small><div class="${a.a.tooltipQuantity}">${o}</div>`;e+=Object(n.d)({tmpl:r.a.chartItem,data:{...this,height:l,tootipContent:Object(n.b)(c)}})}return`<ul class="${a.a.list}">${e}</ul>`}addActions(){this.tooltips=new i.a({elem:this.elem,dimSiblings:!0})}async changeDate(t){if(!t.detail||!t.detail.dates)return;const{from:e,to:s}=t.detail.dates;this.dates={from:e,to:s},this.url=this.getUrl(),this.elem.innerHTML="",await this.render(),this.append(this.elem)}}}).call(this,s(12))},function(t,e,s){"use strict";(function(t){s.d(e,"a",(function(){return d}));var i=s(14),n=s(2),a=s(13),r=s(8),o=s(0),l=s(10),c=s(11);s(24);class d extends HTMLElement{constructor(){super(),this.sorting={current:null,isAsc:!0},this.page={items:20,current:0,isDataEnded:!1},this.apiUrl=t.env.API_URL||"https://course-js.javascript.ru",this.changeDate=this.changeDate.bind(this)}async connectedCallback(){const{url:t,fieldsList:e,orderField:s,orderDirection:i,queryParams:n,isDynamic:a,from:r,to:l}=this.dataset;this.dates={from:r,to:l},this.url=this.apiUrl+t,this.fieldsList=JSON.parse(e.replace(/'/g,'"')),this.queryParams=n?JSON.parse(n):{},this.isDynamic=+a,this.order={field:s,direction:i},this.initTable=this.initTable.bind(this),this.isLoading=!1,this.order&&void 0!==this.order.direction&&(this.sorting.isAsc=this.order.direction),this.fetchUrl=this.getFetchUrl(),this.onBodyScrollThrottle=Object(o.h)(this.onBodyScroll,this,500),this.initTable(),document.addEventListener("changeDate",this.changeDate)}static get observedAttributes(){return["data-query-params"]}attributeChangedCallback(t,e,s){if("data-query-params"===t){if(!s||null===e||s===e)return;this.queryParams=JSON.parse(s),this.page.current=0,this.page.isDataEnded=!1,this.fetchUrl=this.getFetchUrl(),this.tBody.innerHTML="",this.fillTBody()}}async loadData(){this.isLoading=!0,this.dataset.loading=1;try{const t=await Object(o.c)(this.fetchUrl);return this.isLoading=!1,t.length||this.addPageMessage({title:"Nothing found 🤷‍♀️",text:"Try to change search params"}),t}catch(t){this.addPageMessage({error:t})}finally{this.dataset.loading=0}}initTable(){this.createLayout(),this.addElemHeader(),this.addTableEvents(),this.fillTBody()}async fillTBody(){this.page.isDataEnded||(this.tableRows=await this.loadData(),this.tableRows.length<this.page.items&&(this.page.isDataEnded=!0,0===this.tableRows.length)||(!this.isDynamic&&this.order&&this.order.field?this.sortRows(this.order.field):this.renderTBody()))}getFetchUrl(){const t=new Set(["title_like","price_lte","price_gte","from","to","status"]),e=this.filterQueryParams(),s={start:this.page.current*this.page.items,end:(this.page.current+1)*this.page.items,sort:this.order.field,order:Object(l.b)(this.sorting.isAsc),...e};this.dates&&this.dates.from&&(s.from=this.dates.from,s.to=this.dates.to);let i="";for(const e in s){let n="_";t.has(e)&&(n=""),i+=`&${n}${e}=${s[e]}`}return this.url+i}createLayout(){this.classList.add(n.a.elem),this.table=document.createElement("div"),this.table.classList.add(n.a.table),this.tBody=document.createElement("div"),this.tBody.classList.add(n.a.tbody),this.table.append(this.tBody),this.append(this.table),this.insertAdjacentHTML("beforeEnd",'<div class="spinner"></div>')}addElemHeader(){let t="";this.fieldsList.forEach(e=>{let s=n.a.cell;const i={sorter:"",sortDirection:""};if(r.a[e].compare&&(s+=` ${n.a.cellSorter}`,i.sorter='data-sorter="1"'),e===this.order.field){const t=Object(l.b)(this.sorting.isAsc);i.sortDirection=`data-sort-direction="${t}"`}t+=`<div class="${s} ${n.a.cell}--${e}"\n        data-name="${e}"\n        ${i.sorter}\n        ${i.sortDirection}\n        >${r.a[e].title}</div>`});const e=`<div class="${n.a.thead}"><div class="${n.a.header} ${n.a.row}">\n      ${t}\n    </div></div>`;this.table.insertAdjacentHTML("afterBegin",e),this.sorting.current=this.table.querySelector("[data-sort-direction]")}sorterOnClick(t){const{name:e}=t.dataset;t.dataset.sortDirection?this.sorting.isAsc=!this.sorting.isAsc:(this.sorting.current&&delete this.sorting.current.dataset.sortDirection,this.sorting.isAsc=!0,this.sorting.current=t),t.dataset.sortDirection=Object(l.b)(this.sorting.isAsc),this.isDynamic?this.sortRowsDynamic(e):this.sortRows(e)}sortRows(t){this.tableRows.sort(r.a[t].compare),this.sorting.isAsc||this.tableRows.reverse(),this.tBody.innerHTML="",this.renderTBody()}sortRowsDynamic(t){this.order.field=t,this.page.current=0,this.page.isDataEnded=!1,this.fetchUrl=this.getFetchUrl(),this.tBody.innerHTML="",this.fillTBody()}addTableEvents(){this.table.addEventListener("click",this),window.addEventListener("scroll",this.onBodyScrollThrottle),this.tooltips=new i.a({elem:this})}handleEvent(){event.target.dataset.sorter&&this.sorterOnClick(event.target)}onBodyScroll(){if(this.isLoading)return;document.documentElement.getBoundingClientRect().bottom-window.innerHeight<100&&(this.page.current++,this.fetchUrl=this.getFetchUrl(),this.fillTBody())}renderTBody(){this.pageYOffset=window.pageYOffset,this.tableRows.forEach(t=>{let e="";const{status:s}=t;this.fieldsList.forEach(i=>{const o=[n.a.cell,`${n.a.cell}--${i}`,`${n.a.cell}--${a.a[s].toLowerCase()}`],l=(0,r.a[i].render)(t);void 0!==l&&(e+=`<div class="${o.join(" ")}">\n            ${l}\n          </div>`)}),this.tBody.insertAdjacentHTML("beforeEnd",`<a\n          class="${n.a.link}"\n          href="/shop-admin-page/products/${t.id}">\n          <div class="${n.a.row}">${e}</div>\n        </a>`)}),this.pageYOffset&&window.scrollTo(window.scrollX,this.pageYOffset)}async changeDate(t){t.detail&&t.detail.dates&&(this.dates=t.detail.dates,this.fetchUrl=this.getFetchUrl(),this.tBody.innerHTML="",this.fillTBody())}filterQueryParams(){const t={};for(const e in this.queryParams){const s=this.queryParams[e];if(void 0!==s)if(r.a[e]&&r.a[e].formatForQuery){const i=r.a[e].formatForQuery({key:e,value:s});i&&(t[i.key]=i.value)}else t[e]=s}return t}addPageMessage(t){const e=new c.a(t);this.tBody.insertAdjacentHTML("beforeEnd",`<div class="${n.a.row}">\n        <div class="${n.a.cellMessage}">${e.elem.outerHTML}</div>\n      </div>`)}}}).call(this,s(12))},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){},function(t,e,s){var i={"./categories/index.js":29,"./dashboard/index.js":31,"./error404/index.js":32,"./products/edit/index.js":33,"./products/index.js":36};function n(t){return a(t).then(s)}function a(t){return Promise.resolve().then((function(){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}))}n.keys=function(){return Object.keys(i)},n.resolve=a,n.id=28,t.exports=n},function(t,e,s){"use strict";s.r(e),function(t){var i=s(0),n=s(11),a=s(9),r=s(3);s(30);e.default=class{constructor(){this.apiUrl=t.env.API_URL||"https://course-js.javascript.ru",this.fetchUrl=`${this.apiUrl}/api/rest/categories?_sort=weight&_refs=subcategory`,this.fetchSaveUrl=`${this.apiUrl}/api/rest/subcategories`,this.listClick=this.listClick.bind(this)}async render(){const{categories:t,message:e}=await this.loadData();if(e)return Object(i.a)(`<div class="page-content">\n        <section class="page-section categories">\n          <h2 class="page-section__title">Categories</h2>\n\n          ${e.elem.outerHTML}\n        </section>\n      </div>\n      `);const s=this.createList(t);return this.elem=Object(i.a)(`<div class="page-content">\n      <section class="page-section categories">\n        <h2 class="page-section__title">Categories</h2>\n\n        ${s}\n      </section>\n    </div>`),this.addEvents(),this.elem}async loadData(){try{return{categories:await Object(i.c)(this.fetchUrl)}}catch(t){return{message:new n.a({error:t})}}}createList(t,e=!1){let s="",i=r.a.listTop,n=r.a.item,a="";if(e?(i=r.a.listSubcats,n+=` ${r.a.itemSub}`,a='is="draggable-list"'):n+=` ${r.a.itemTop}`,0===t.length)return"";for(const i of t){let t="",a=i.title;const o=i.subcategories;let l="";if(e){const t=this.getPlural(i.count,["product","products"]);l=`<span class="${r.a.counter}">${t}</span>`}o&&(a=` <button class="${r.a.toggler}">${i.title}</button>`,t=this.createList(o,!0)),s+=`<li class="${n}" id="${i.id}">\n        ${a}\n        ${l}\n        ${t}\n      </li>`}return`<ul\n      class="${r.a.list} ${i}" ${a}\n      >\n      ${s}\n    </ul>`}addEvents(){this.elem.querySelector(`.${r.a.listTop}`).addEventListener("click",this.listClick),this.addMutationObservers()}listClick(){event.target.closest(`.${r.a.toggler}`)&&event.target.closest(`.${r.a.itemTop}`).classList.toggle(r.a.itemOpen)}getPlural(t,e){let s=e[0];return 1!==t&&(s=e[1]),`${t} ${s}`}async saveItemsPositions(t){const e=this.getDataFromList(t),s={method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)};await Object(i.c)(this.fetchSaveUrl,s);Object(a.a)("Categories order was saved","success")}getDataFromList(t){const e=t.querySelectorAll(`.${r.a.item}`);return e.map=[].map,e.map((t,e)=>({id:t.id,weight:e}))}addMutationObservers(){const t=this.elem.querySelectorAll(`.${r.a.listSubcats}`),e=new MutationObserver(t=>{t.forEach(t=>{const{type:e,target:s}=t,i=s.dataset&&+s.dataset.isDragging,n=t.addedNodes;"childList"===e&&!i&&n.length&&this.saveItemsPositions(s)})});t.forEach(t=>{e.observe(t,{childList:!0})})}}}.call(this,s(12))},function(t,e,s){},function(t,e,s){"use strict";s.r(e);var i=s(0);const n=new Date;n.setMonth(n.getMonth()-1);const a=new Date,r=n.toISOString(),o=a.toISOString();e.default=class{async render(){return Object(i.a)(`<div class="page-content">\n      <header class="page-content__header">\n        <h2 class="page-content__title">Dashboard</h2>\n\n        <range-picker\n          data-from="${r}"\n          data-to="${o}"\n          ></range-picker>\n        </header>\n\n        <section class="page-section page-section--column-charts">\n          <column-chart\n            data-type="orders"\n            data-from="${r}"\n            data-to="${o}"\n          ></column-chart>\n\n          <column-chart\n            data-type="sales"\n            data-is-money="true"\n            data-from="${r}"\n            data-to="${o}"\n          ></column-chart>\n\n          <column-chart\n            data-type="customers"\n            data-from="${r}"\n            data-to="${o}"\n          ></column-chart>\n        </section>\n\n        <section class="page-section">\n          <h3 class="page-section__title">Bestsellers</h3>\n\n        <sortable-table\n          data-url="/api/dashboard/bestsellers?_embed=subcategory.category",\n          data-is-dynamic="0"\n          data-fields-list="['images', 'title', 'subcategory', 'quantity', 'price', 'status']"\n          data-order-field='title',\n          data-order-direction="1"\n          data-from="${r}"\n          data-to="${o}"\n          ></sortable-table>\n        </section>\n      </div>`)}}},function(t,e,s){"use strict";s.r(e);var i=s(0);e.default=class{async render(){return Object(i.a)('<div class="page-content">\n        <section class="page-section page-section--404">\n          <h2 class="page-section__title">Page not found</h2>\n          <p>No such page</p>\n        </section>\n      </div>')}}},function(t,e,s){"use strict";s.r(e),function(t){var i=s(0),n=s(11),a=s(7),r=s(1),o=s(4),l=s(9),c=s(6);s(34),s(35);e.default=class{constructor(e){this.id=e[0].replace("products/","").replace(/^add$/,""),e[0]||(this.id="3d-ochki-optoma-zd302"),this.apiUrl=t.env.API_URL||"https://course-js.javascript.ru",this.fetchProductUrl=this.apiUrl+`/api/rest/products?id=${this.id}`,this.fetchCategoriesUrl=this.apiUrl+"/api/rest/categories?_sort=weight&_refs=subcategory",this.fetchSaveUrl=this.apiUrl+"/api/rest/products",this.uploadImage=this.uploadImage.bind(this),this.deleteImage=this.deleteImage.bind(this),this.submitForm=this.submitForm.bind(this)}async render(){const t=Object(c.b)(this.id),{productData:e,categories:s,errorMessage:n}=await this.loadData();if(n)return Object(i.a)(`<div class="page-content">\n        ${t}\n\n        ${n.outerHTML}\n      </div>\n      `);const o=e[0],l=a.a.id.render({id:this.id}),d=Object(c.d)({product:o,categories:s});return this.elem=Object(i.a)(`<div class="page-content">\n      ${t}\n\n      <form class="${r.a.form}">\n        ${l}\n        <ul class="${r.a.list}">\n          ${d.join("\n")}\n        </ul>\n\n        <footer class="${r.a.footer}">\n          <button class="${r.a.submit} ${r.a.submitColored}">Save</button>\n        </footer>\n      </form>\n    </div>`),this.imgUploadButton=this.elem.querySelector(`.${r.a.inputUpload}`),this.imgList=this.elem.querySelector(`.${r.a.imgsList}`),this.submitBtn=this.elem.querySelector(`.${r.a.submit}`),this.form=this.elem.querySelector(`.${r.a.form}`),this.idInput=this.elem.querySelector('input[name="id"]'),this.pageContentTitleMain=this.elem.querySelector(`.${r.a.pageContentTitleMain}`),this.id||this.elem.classList.add(r.a.pageContentCreate),this.addEvents(),this.elem}addEvents(){this.imgUploadButton.addEventListener("click",this.uploadImage),this.form.addEventListener("submit",this.submitForm),this.imgList.addEventListener("click",this.deleteImage)}async uploadImage(){let t;this.fileInput=this.fileInputCreate(),this.fileInput.click();this.fileInput.addEventListener("change",async()=>{this.imgUploadButton.classList.add(r.a.inputUploadLoading),this.imgUploadButton.disabled=!0;const e=this.fileInput.files[0];if(!e)return;const s=new FormData;s.append("image",e);try{const e=await Object(i.c)("https://api.imgur.com/3/image",{method:"POST",headers:{Authorization:"Client-ID e2b5c366b2d23fb"},body:s});t=e.data}finally{this.imgUploadButton.classList.remove(r.a.inputUploadLoading),this.imgUploadButton.disabled=!1,this.fileInput.remove()}this.addImageItem(t)})}fileInputCreate(){const t=document.createElement("input");return t.type="file",t.accept="image/*",document.body.append(t),t.hidden=!0,t}addImageItem({id:t,link:e,type:s}){const n=s.split("/")[1],a=Object(i.d)({tmpl:o.b,data:{url:e,source:`${t}.${n}`}});this.imgList.insertAdjacentHTML("beforeEnd",a),Object(l.a)("Image was loaded")}deleteImage(t){t.target.closest(`.${r.a.imgRemove}`)&&t.target.closest(`.${r.a.imgsItem}`).remove()}async submitForm(t){t.preventDefault();const e=this.collectFormData(),s={method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},n=await Object(i.c)(this.fetchSaveUrl,s);let a="Product saved";if(!e.id){a="Product created",this.idInput.value=n.id,this.elem.classList.remove(r.a.pageContentCreate),this.pageContentTitleMain.innerHTML=Object(c.f)(n.id);const t=`/shop-admin-page/product/${n.id}`;history.pushState(null,null,t)}Object(l.a)(a,"success")}collectFormData(){const t={},e={},s=Array.from(new FormData(this.form));for(const i of s){const s=i[0];let n=i[1];a.a[s]?(a.a[s]&&a.a[s].formatForRequest&&(n=a.a[s].formatForRequest(n)),t[s]=n):s.includes("image-")&&(e[s]?e[s].source=n:e[s]={url:n})}return t.images=Object.values(e),t}async loadData(){try{const t=await Promise.all([Object(i.c)(this.fetchProductUrl),Object(i.c)(this.fetchCategoriesUrl)]);return{productData:t[0],categories:t[1]}}catch(t){return{errorMessage:new n.a({error:t}).elem}}}}}.call(this,s(12))},function(t,e,s){"use strict";s.p},function(t,e,s){},function(t,e,s){"use strict";s.r(e);var i=s(0);e.default=class{async render(){return Object(i.a)('\n<div class="page-content">\n  <header class="page-content__header">\n    <h2 class="page-content__title">Products</h2>\n\n    <a\n      class="page-content__header-create control control--green"\n      href="/shop-admin-page/products/add">Add Product\n    </a>\n  </header>\n\n  <table-filter\n    data-fields-list="[\'search\', \'price\', \'status\']"\n    data-target-selector="#products-table"\n    ></table-filter>\n\n  <sortable-table\n    id="products-table"\n    data-url="/api/rest/products?_embed=subcategory.category",\n    data-query-params=\'\'\n    data-is-dynamic="1"\n    data-fields-list="[\'images\', \'title\', \'subcategory\', \'quantity\', \'price\', \'status\']"\n    data-order-field=\'title\',\n    data-order-direction="1"\n    ></sortable-table>\n  </section>\n</div>\n  ')}}},function(t,e,s){},function(t,e,s){"use strict";s.r(e);var i=s(0);s(19);const n="/shop-admin-page/";class a extends HTMLElement{connectedCallback(){this.classList.add("page"),this.append(this.render())}render(){return Object(i.a)(`<div class="page-container">\n      <aside class="page-aside">\n        <h1 class="page-aside__title">\n          <a href="${n}">Shop admin</a>\n        </h1>\n\n        <nav class="page-aside__nav">\n          <ul class="page-aside__list">\n            <li class="page-aside__item">\n              <a\n                class="page-aside__link page-aside__link--dashboard"\n                href="${n}">\n                <span class="page-aside__link-text">\n                  Dashboard\n                </span>\n              </a>\n            </li>\n            <li class="page-aside__item">\n              <a\n                class="page-aside__link page-aside__link--products"\n                href="${n}products">\n                <span class="page-aside__link-text">\n                  Products\n                </span>\n              </a>\n            </li>\n            <li class="page-aside__item">\n              <a\n                class="page-aside__link page-aside__link--categories"\n                href="${n}categories">\n                <span class="page-aside__link-text">\n                  Categories\n                </span>\n              </a>\n            </li>\n          </ul>\n        </nav>\n      </aside>\n\n      <main class="page-main" id="content">\n        \x3c!-- main content will be here --\x3e\n      </main>\n    </div>`)}}var r=s(16),o="rangepicker",l="rangepicker--open",c="rangepicker__input",d="rangepicker__from",u="rangepicker__to",h="rangepicker__selector",m="rangepicker__selector-control",p="rangepicker__calendars",g="rangepicker__cell",f="rangepicker__selected-from",b="rangepicker__selected-between",v="rangepicker__selected-to";var y={input:`<button class="${c}" data-elem="input" type="button">\n  <span\n    class="${d}"\n    data-elem="from">{from}</span> -\n  <span\n    class="${u}"\n    data-elem="to"\n    >{to}</span>\n</button>`,selector:`\n<div class="${h}" data-elem="selector">\n  <div class="${"rangepicker__selector-arrow"}"></div>\n  <button\n    type="button"\n    class="${m} ${m}--left"\n    data-direction="prev"\n  ></button>\n  <button\n    type="button"\n    class="${m} ${m}--right"\n    data-direction="next"\n  ></button>\n  <div class="${p}"></div>\n</div>\n`,calendar:`\n<div class="${"rangepicker__calendar"}">\n  <div class="${"rangepicker__month-indicator"}">\n    <time datetime="{month}">{month}</time>\n  </div>\n  <div class="${"rangepicker__day-of-week"}">\n    {weekdays}\n  </div>\n  <div class="${"rangepicker__date-grid"}">\n    {days}\n  </div>\n</div>\n`,day:`\n<button type="button" class="${g} {mod}" data-value="{dateTime}" style="{style}">{dateNum}</button>\n`};s(22),s.p,s.p;class _ extends HTMLElement{constructor(){super(),this.togglePicker=this.togglePicker.bind(this),this.selectorOnClick=this.selectorOnClick.bind(this),this.bodyOnClick=this.bodyOnClick.bind(this),this.updateRange=this.updateRange.bind(this),this.isOpened=!1,this.elem=this,this.elem.classList.add("rangepicker")}async connectedCallback(){const{from:t,to:e}=this.dataset;this.dates={from:new Date(t),to:new Date(e)},this.monthes=this.getDisplayedMonthes(),this.newDates=[],this.addInput(),document.addEventListener("changeDate",this.updateRange)}getDisplayedMonthes(){const t=new Date(this.dates.from);let e=t.getMonth();t.setDate(1);const s=new Date(t);return s.setMonth(++e),[t,s]}addInput(){const t={from:this.dates.from.toLocaleDateString(),to:this.dates.to.toLocaleDateString()},e=y.input,s=Object(i.d)({tmpl:e,data:t});this.elem.insertAdjacentHTML("afterBegin",s),this.input=this.elem.querySelector(`.${c}`),this.inputFrom=this.input.querySelector(`.${d}`),this.inputTo=this.input.querySelector(`.${u}`),this.input.addEventListener("pointerdown",this.togglePicker),document.body.addEventListener("pointerdown",this.bodyOnClick,{capture:!0})}bodyOnClick(){!event.target.closest(`.${o}`)&&this.isOpened&&this.hidePicker()}updateInput(){this.inputFrom.innerHTML=this.dates.from.toLocaleDateString(),this.inputTo.innerHTML=this.dates.to.toLocaleDateString()}updateRange(){this.monthes=this.getDisplayedMonthes(),this.newDates=[],this.updateInput(),this.hidePicker()}togglePicker(){this.isOpened?this.hidePicker():(this.showPicker(),this.isOpened=!0)}showPicker(){this.selector?this.calendars.innerHTML="":(this.addSelector(),this.selector=this.elem.querySelector(`.${h}`),this.calendars=this.elem.querySelector(`.${p}`),this.selector.addEventListener("click",this.selectorOnClick)),this.addCalendars(),this.elem.classList.add(l)}hidePicker(){this.elem.classList.remove(l),this.isOpened=!1,this.newDates=[]}addSelector(){const t=y.selector;this.elem.insertAdjacentHTML("beforeEnd",t)}selectorOnClick(){const{dataset:t}=event.target;t.value?this.setDay(event.target):t.direction&&this.moveMonth(t.direction)}setDay(t){const e=t.dataset.value;if(0===this.newDates.length)return this.newDates.push(new Date(e)),void this.updateSelected(t);this.newDates.push(new Date(e)),this.newDates.sort((t,e)=>t-e),this.dates={from:this.newDates[0],to:this.newDates[1]},document.dispatchEvent(new CustomEvent("changeDate",{detail:{dates:{from:this.dates.from.toISOString(),to:this.dates.to.toISOString()}}}))}moveMonth(t){let e=1;"prev"===t&&(e=-1),this.monthes.forEach(t=>{t.setMonth(t.getMonth()+e)}),this.updateCalendars()}addCalendars(){this.monthes.forEach(t=>{this.calendars.insertAdjacentHTML("beforeEnd",this.getCalendar(t))})}updateCalendars(){this.calendars.innerHTML="",this.addCalendars()}updateSelected(t){const e=this.elem.querySelectorAll(`.${g}`),s=[b,f,v];e.forEach(t=>{t.classList.remove(...s)}),t.classList.add(f)}getCalendar(t){const e={month:t.toLocaleString("default",{month:"long"}),weekdays:Object(i.g)("div"),days:this.getCells(t)},s=y.calendar;return Object(i.d)({tmpl:s,data:e})}getCells(t){const e=y.day,s=new Date(t),n=s.getMonth();let a=1,r="";for(;s.getMonth()===n;){const t=this.getCellStartStyle(s),n=this.getCellMod(s),o={dateTime:s.toISOString(),dateNum:s.getDate(),style:t,mod:n};r+=Object(i.d)({tmpl:e,data:o}),s.setDate(++a)}return r}getCellStartStyle(t){let e="";if(t.getDate()>1)return e;let s=t.getDay();return 0===s&&(s=7),e=`grid-column-start: ${s}`,e}getCellMod(t){let e="";if(this.newDates.length>0)return e;const s=t.valueOf(),i=this.dates.from.valueOf(),n=this.dates.to.valueOf();return s>i&&s<n?e=b:s===i?e=f:s===n&&(e=v),e}}var $=s(17);s(25),s.p;const w="draggable-list",L="draggable-list__item",T="draggable-list__item--pressed",D="draggable-list__item--dragged",E="draggable-list__item--placeholder";class O extends HTMLUListElement{constructor(){super(),this.current={},this.startDrag=this.startDrag.bind(this),this.stopDrag=this.stopDrag.bind(this),this.move=this.move.bind(this),this.setPlaceholderHeight=this.setPlaceholderHeight.bind(this),this.isDragging=!1}async connectedCallback(){this.classList.add(w),this.items=this.querySelectorAll("li"),this.initList(),this.addEventListener("pointerdown",this.startDrag),this.addMutationObserver()}initList(){0!==this.items.length&&(this.addClassToItems(),this.disableDefaultDragstart(),this.placeholder=this.createPlaceholder(),this.addEventListener("pointerdown",this.setPlaceholderHeight,{once:!0}))}startDrag(t){"BUTTON"!==t.target.tagName&&(this.current.elem=t.target.closest(".draggable-list__item"),this.current.elem&&(this.isDragging=!0,t.preventDefault(),this.dataset.isDragging=1,this.current.height=this.current.elem.offsetHeight,this.current.half=this.current.height/2,this.current.offset=this.getCurrentOffset(t),this.current.scrollSteps=0,this.coords=this.getListCoords(),this.setCurrentItemTop(t),this.current.elem.classList.add(T),this.isJustStarted=!0,this.addEventListener("pointermove",this.move),this.addEventListener("pointerup",this.stopDrag),document.addEventListener("pointerup",this.stopDrag)))}getCurrentOffset(t){const{top:e}=this.current.elem.getBoundingClientRect();return t.clientY-e}getListCoords(){return this.getBoundingClientRect()}move(t){t.preventDefault(),this.isJustStarted&&(this.current.elem.classList.add(D),this.current.elem.replaceWith(this.placeholder),this.append(this.current.elem),this.isJustStarted=!1),this.setCurrentItemTop(t),this.scrollOnMove(t);const e=t.clientY-this.coords.top-this.current.half+this.current.half;for(const t of this.items){if(t.classList.contains(D))continue;const s=t.offsetTop,i=s+t.offsetHeight,n=s+t.offsetHeight/2;if(e>s&&e<i){e<=n?t.after(this.placeholder):t.before(this.placeholder);break}}}setCurrentItemTop(t){this.coords=this.getListCoords();let e=t.clientY-this.coords.top-this.current.offset;const s=-this.current.half,i=this.coords.height-this.current.half;e<s?e=s:e>i&&(e=i),this.current.elem.style.top=`${e}px`}scrollOnMove(t){const e=document.documentElement.clientHeight,s=this.current.half,i=t.clientY>e-s,n=t.clientY<s;let a=0;i?a=this.current.half:n&&(a=-this.current.half),a&&(window.scrollBy(0,a),this.setCurrentItemTop(t),this.current.offset=this.getCurrentOffset(t))}stopDrag(){this.placeholder.replaceWith(this.current.elem),this.current.elem.classList.remove(D),this.current.elem.classList.remove(T),this.current.elem.style.top="",this.isDragging=!1,this.dataset.isDragging=0,this.removeEventListener("pointermove",this.move),this.removeEventListener("pointerup",this.stopDrag)}createPlaceholder(){if(this.placeholder)return this.placeholder;const t=this.items[0].cloneNode(!0);return t.classList.add(E,L),t.innerHTML="",t}setPlaceholderHeight(){const t=this.items[0];this.placeholder.style.minHeight=`${t.offsetHeight}px`}addClassToItems(){this.items.forEach(t=>t.classList.add(L))}addMutationObserver(){new MutationObserver(t=>{t.forEach(({type:t})=>{"childList"!==t||this.isDragging||(this.items=this.querySelectorAll("li"),this.initList())})}).observe(this,{childList:!0})}disableDefaultDragstart(){this.items.forEach(t=>{t.ondragstart=()=>!1})}}s(26);class C{constructor(t){this.render(t),this.control={elem:this.elem},this.form=this.control.elem.closest("form"),this.thumbs={from:{elem:this.control.elem.querySelector(".double-range__thumb--from")},to:{elem:this.control.elem.querySelector(".double-range__thumb--to")},currentKey:null,current:null,min:null,max:null},this.thumbsList={from:this.thumbs.from,to:this.thumbs.to},this.inputs={from:this.control.elem.querySelector(".double-range__input--from"),to:this.control.elem.querySelector(".double-range__input--to")},this.values={from:this.control.elem.querySelector(".double-range__label-text--from"),to:this.control.elem.querySelector(".double-range__label-text--to")},this.coords={x:0,min:null,max:null},this.maxValue=this.inputs.to.max,this.setThumbPosition=this.setThumbPosition.bind(this),this.pointerDown=this.pointerDown.bind(this),this.moveThumb=this.moveThumb.bind(this),this.stopDrag=this.stopDrag.bind(this),this.reset=this.reset.bind(this),this.init()}render(t){const e={class:t.className,...t.dataset},s=Object(i.d)({tmpl:'\n<div class="{class} double-range">\n  <span\n    class="double-range__line"\n  ></span>\n\n  <label class="double-range__label">\n    <input\n      class="\n        double-range__input\n        double-range__input--from"\n      type="range"\n      min="{min}"\n      max="{max}"\n      step="{step}"\n      value="{valueMin}"\n      name="{nameMin}"\n      data-key="from"\n    >\n    <span\n      class="\n        double-range__thumb\n        double-range__thumb--from"\n      data-key="from"\n    ></span>\n    <span\n      class="\n        double-range__label-text\n        double-range__label-text--from"></span>\n  </label>\n\n  <label class="double-range__label">\n    <input\n      class="\n        double-range__input\n        double-range__input--to"\n      type="range"\n      min="{min}"\n      max="{max}"\n      step="{step}"\n      value="{valueMax}"\n      name="{nameMax}"\n      data-key="to"\n    >\n    <span\n      class="\n        double-range__thumb\n        double-range__thumb--to"\n      data-key="to"\n    ></span>\n    <span\n      class="\n        double-range__label-text\n        double-range__label-text--to"></span>\n  </label>\n</div>\n',data:e});this.elem=Object(i.a)(s),t.replaceWith(this.elem)}init(){this.disableDefaultDragstart(),this.addEvents(),setTimeout(()=>{this.reset()},100)}reset(){this.control.coords=this.control.elem.getBoundingClientRect(),this.thumbs.width=this.thumbs.from.elem.offsetWidth,this.thumbs.maxLeft=this.control.elem.offsetWidth-this.thumbs.width,this.coords.min=0,this.coords.max=this.thumbs.maxLeft,this.setThumbPosition()}disableDefaultDragstart(){Object.values(this.thumbsList).forEach(t=>{t.ondragstart=()=>!1})}setThumbPosition(t={}){const{inputKey:e,reset:s}=t;for(const t in this.thumbsList){if(e&&e!==t)continue;const i=this.inputs[t],n=this.thumbs[t].elem,a=this.values[t],r=this.control.elem.clientWidth;if("from"===t){const t=this.inputs.to,e=+i.value,s=+t.value;e>=s&&(i.value=s-t.step)}else{const t=this.inputs.from,e=+i.value,s=+t.value,n=+t.step;e<=s&&(i.value=s+n)}const o=s?i.defaultValue:i.value;let l=o/this.maxValue*(r-this.thumbs.width);l=l.toFixed(),this.thumbs[t].x=l,n.style.left=`${l}px`,a.innerHTML=o,a.style.left=`${l}px`}}addEvents(){for(const t in this.inputs){const e=this.inputs[t];this.thumbs[t].elem.ondragstart=()=>!1,e.addEventListener("input",()=>{this.setThumbPosition({inputKey:t})})}this.control.elem.addEventListener("pointerdown",this.pointerDown),window.addEventListener("resize",this.reset),this.form.addEventListener("reset",()=>{this.setThumbPosition({reset:!0})})}pointerDown(t){const e=t.target.dataset.key;e&&(t.preventDefault(),this.thumbs.currentKey=e,this.thumbs.current=this.thumbs[e],this.startDrag())}startDrag(){const t=this.thumbs.current.elem.getBoundingClientRect();this.thumbs.offset=event.pageX-t.left,this.elemCoords=this.control.elem.getBoundingClientRect(),this.control.elem.addEventListener("pointermove",this.moveThumb),this.control.elem.addEventListener("pointerup",this.stopDrag),document.addEventListener("pointerup",this.stopDrag)}moveThumb(t){this.coords.x=t.pageX-this.elemCoords.left-this.thumbs.offset;const e=this.coords.max,s=this.thumbs.currentKey,i=this.coords.x/e*this.maxValue;this.inputs[s].value=i,this.inputs[s].focus();const n=new Event("input");this.inputs[s].dispatchEvent(n)}stopDrag(){this.control.elem.removeEventListener("pointermove",this.moveThumb),this.control.elem.removeEventListener("pointerup",this.stopDrag),document.removeEventListener("pointerup",this.stopDrag)}}var S="filter",j="filter-form",k="filter-form__list",x="filter-form__item",M="filter-form__label",P="filter-form__input",U="filter-form__input--text";const q=`<label class="${M}">\n  {fieldName}\n\n  <input\n    class="${P} ${U} ${"filter-form__input--search"}"\n    type="search"\n    name="{id}"\n    value="{value}"/>\n</label>`,F=`<label class="${M}">\n  {fieldName}\n\n  <select\n    class="${P} ${"filter-form__input--select"}"\n    name="{id}">\n    {options}\n  </select>\n</label>`,H=`<div\n  data-elem="double-range"\n  data-min="0"\n  data-max="4000"\n  data-step="1"\n  data-value-min="0"\n  data-value-max="4000"\n  data-name-min="price_gte"\n  data-name-max="price_lte"\n  class="${"filter-form__range"}"\n></div>`;var I=[{text:"Disabled",value:0},{text:"Enabled",value:1}];function R(t){return+t}var B={search:{render:()=>Object(i.d)({tmpl:q,data:{id:"search",fieldName:"Search",value:""}})},price:{render:({price:t})=>H,formatForRequest:R},status:{render({status:t}){const e=[{value:"",text:"Any"},...I],s={id:"status",fieldName:"Status",value:t,options:(n=e,a="",n.map((t,e)=>{const s=void 0!==t.value?t.value:e,i=t.text||t;return`<option value="${s}" ${s===a?"selected":""}>${i}</option>`}).join(""))};var n,a;return Object(i.d)({tmpl:F,data:s})},formatForRequest:R}};s(27);class N extends HTMLElement{async connectedCallback(){const{fieldsList:t,targetSelector:e}=this.dataset;this.targetElem=document.querySelector(e),this.classList.add(S),this.form=document.createElement("form"),this.form.classList.add(j),this.list=document.createElement("ul"),this.list.classList.add(k),this.form.append(this.list),this.fieldsList=JSON.parse(t.replace(/'/g,'"')),this.updateParamsThrottle=Object(i.h)(this.updateTargetQueryParams,this,1e3),this.append(this.form),this.addForm(),this.addEvents()}addForm(){this.fieldsList.forEach(t=>{if(B[t]){const e=B[t].render({}),s=Object(i.a)(`<li class="${x}">${e}</li>`);this.list.append(s)}});const t=this.form.querySelector('[data-elem="double-range"]');t&&new C(t)}addEvents(){this.inputs=this.querySelectorAll("input, select"),this.inputs.forEach(t=>{t.addEventListener("input",this.updateParamsThrottle)})}updateTargetQueryParams(){const t=Object.fromEntries(new FormData(this.form));this.targetElem.dataset.queryParams=JSON.stringify(t)}}class A{constructor(){this.routes=[],this.documentClick=this.documentClick.bind(this),document.addEventListener("click",this.documentClick)}static instance(){return this._instance||(this._instance=new A),this._instance}addRoute(t,e){return this.routes.push({pattern:t,path:e}),this}setNotFoundPage(t){return this.notFoundPagePath=t,this}navigate(t){history.pushState(null,null,t),this.route()}async route(){const t=(e=window.location.pathname,decodeURI(e).replace(/^\/shop-admin-page/,"").replace(/^\/|\/$/,"").replace(/\?.*$/,"").replace(/#.*$/,""));var e;let s;for(const e of this.routes)if(s=t.match(e.pattern),s){this.page=await this.changePage(e.path,s);break}s||(this.page=await this.changePage(this.notFoundPagePath))}async changePage(t,e){this.page&&this.page.destroy&&this.page.destroy(),this.page=await async function(t,e){const{default:i}=await s(28)(`./${t}/index.js`),n=new i(e),a=await n.render(),r=document.getElementById("content");r.innerHTML="",r.append(a)}(t,e)}addListener(){window.addEventListener("popstate",()=>this.route()),this.route()}documentClick(t){const e=t.target.closest("a");if(!e)return;const s=e.getAttribute("href");s&&(s.startsWith("/")||s.startsWith("./"))&&(t.preventDefault(),this.navigate(s))}}s(37);A.instance().addRoute(/^$/,"products/edit").addRoute(/^categories$/,"categories").addRoute(/^products\/([\S()-]+)/g,"products/edit").addRoute(/^products\/add$/,"products/edit").addRoute(/^products$/,"products").setNotFoundPage("error404").addListener(),window.customElements.define("page-layout",a),window.customElements.define("column-chart",r.a),window.customElements.define("range-picker",_),window.customElements.define("sortable-table",$.a),window.customElements.define("draggable-list",O,{extends:"ul"}),window.customElements.define("table-filter",N)}]);